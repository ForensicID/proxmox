apt install -y vim apt-transport-https wget gnupg

wget -O - https://packages.icinga.com/icinga.key | gpg --dearmor -o /usr/share/keyrings/icinga-archive-keyring.gpg

. /etc/os-release; if [ ! -z ${UBUNTU_CODENAME+x} ]; then DIST="${UBUNTU_CODENAME}"; else DIST="$(lsb_release -c| awk '{print $2}')"; fi;  echo "deb [signed-by=/usr/share/keyrings/icinga-archive-keyring.gpg] https://packages.icinga.com/ubuntu icinga-${DIST} main" >  /etc/apt/sources.list.d/${DIST}-icinga.list
echo "deb-src [signed-by=/usr/share/keyrings/icinga-archive-keyring.gpg] https://packages.icinga.com/ubuntu icinga-${DIST} main" >>  /etc/apt/sources.list.d/${DIST}-icinga.list

apt update
apt install icinga2 monitoring-plugins mariadb-server mariadb-client icinga2-ido-mysql -y

mysql -u root -p
CREATE DATABASE icinga2;
GRANT SELECT, INSERT, UPDATE, DELETE, DROP, CREATE VIEW, INDEX, EXECUTE ON icinga.* TO 'icinga2'@'localhost' IDENTIFIED BY 'Skill20';
FLUSH PRIVILEGES;
quit

mysql -u root -p icinga2 < /usr/share/icinga2-ido-mysql/schema/mysql.sql
nano /etc/icinga2/features-available/ido-mysql.conf

icinga2 feature enable ido-mysql
systemctl restart icinga2
icinga2 api setup

nano /etc/icinga2/conf.d/api-users.conf
object ApiUser "icingaweb2" {
  password = "Skill20"
  permissions = [ "status/query", "actions/*", "objects/modify/*", "objects/query/*" ]
}

systemctl restart icinga2
apt install icingaweb2 libapache2-mod-php icingacli -y

mysql -u root -p
CREATE DATABASE icingaweb2;
GRANT ALL ON icingaweb2.* TO icingaweb2@localhost IDENTIFIED BY 'Skill20';
FLUSH PRIVILEGES;
quit

icingacli setup token create
icingacli setup token show

http://[domain-name-or-ip-address]/icingaweb2/setup
icinga2 feature enable command
systemctl restart icinga2.service
