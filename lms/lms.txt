apt install -y vim apt-transport-https wget gnupg

add-apt-repository ppa:ondrej/php
apt-get install nginx php7.4 php7.4-fpm php7.4-cli php7.4-mysql php7.4-curl php7.4-json libapache2-mod-php7.4 php7.4-curl php7.4-gd php7.4-mbstring php7.4-xml php7.4-xmlrpc php7.4-soap php7.4-intl php7.4-zip php7.4-cli php7.4-mysql php7.4-common php7.4-opcache php7.4-pgsql php7.4-gmp php7.4-imagick -y

wget -O - https://packages.icinga.com/icinga.key | gpg --dearmor -o /usr/share/keyrings/icinga-archive-keyring.gpg

. /etc/os-release; if [ ! -z ${UBUNTU_CODENAME+x} ]; then DIST="${UBUNTU_CODENAME}"; else DIST="$(lsb_release -c| awk '{print $2}')"; fi;  echo "deb [signed-by=/usr/share/keyrings/icinga-archive-keyring.gpg] https://packages.icinga.com/ubuntu icinga-${DIST} main" >  /etc/apt/sources.list.d/${DIST}-icinga.list
echo "deb-src [signed-by=/usr/share/keyrings/icinga-archive-keyring.gpg] https://packages.icinga.com/ubuntu icinga-${DIST} main" >>  /etc/apt/sources.list.d/${DIST}-icinga.list

apt update
apt install icinga2 monitoring-plugins icinga2-ido-pgsql -y

sudo su postgres
psql
create database icinga2;
create user icinga2 with password 'Skills39';
grant all privileges on database icinga2 to icinga2;
\q

mysql -u root -p icinga2 < /usr/share/icinga2-ido-mysql/schema/mysql.sql
nano /etc/icinga2/features-available/ido-mysql.conf

icinga2 feature enable ido-mysql
systemctl restart icinga2
icinga2 api setup

nano /etc/icinga2/conf.d/api-users.conf
object ApiUser "icingaweb2" {
  password = "Skill20"
  permissions = [ "status/query", "actions/*", "objects/modify/*", "objects/query/*" ]
}

systemctl restart icinga2
apt install icingaweb2 libapache2-mod-php icingacli -y

mysql -u root -p
CREATE DATABASE icingaweb2;
GRANT ALL ON icingaweb2.* TO icingaweb2@localhost IDENTIFIED BY 'Skill20';
FLUSH PRIVILEGES;
quit

icingacli setup token create
icingacli setup token show

http://[domain-name-or-ip-address]/icingaweb2/setup
icinga2 feature enable command
systemctl restart icinga2.service
